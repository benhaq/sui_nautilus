# publish the enclave package
cd move/enclave
sui move build && sui client publish

# find this in output and set env var
ENCLAVE_PACKAGE_ID=0x1999bb86ba10fa0d39ac42ad591fefe73bf29eec86b12b3cedbf06454e2e46c0

# publish the seal-policy app package
cd ../seal-policy
sui move build && sui client publish

# find these in output and set env vars
CAP_OBJECT_ID=0x5f317226a96db3db7ae53e1281fbdcba3042028c6e6040a9b83e6f6942d5d251
ENCLAVE_CONFIG_OBJECT_ID=0x90b598c038fca1ea6010ed5d12ce20d2b9b8b935ed83f4cc1aa88f7eb0c096f5
APP_PACKAGE_ID=0x1999bb86ba10fa0d39ac42ad591fefe73bf29eec86b12b3cedbf06454e2e46c0

# update seal_config.yaml with APP_PACKAGE_ID inside the enclave

# configure ec2 instance for enclave, see main guide for more details: UsingNautilus.md

# ssh in the ec2 instance containing the repo on configured diff: docker build, run and expose
make ENCLAVE_APP=seal-example && make run && sh expose_enclave.sh

# find the pcrs and set env vars
cat out/nitro.pcrs

PCR0=3aa0e6e6ed7d8301655fced7e6ddcc443a3e57bf62f070caa6becf337069e859c0f03d68136440ff1cab8adefd20634c
PCR1=b0d319fa64f9c2c9d7e9187bc21001ddacfab4077e737957fa1b8b97cc993bed43a79019aebfd40ee5f6f213147909f8
PCR2=fdb2295dc5d9b67a653ed5f3ead5fc8166ec3cae1de1c7c6f31c3b43b2eb26ab5d063f414f3d2b93163426805dfe057e
PCR16=120d305756af7e5c00ebf375b76c6124fd2ae7256427e31ab7d2bfa9cd3caf61d1c6ab4dcd0504f0ae364fd070cb7b15
MODULE_NAME=timeline
OTW_NAME=TIMELINE
ENCLAVE_URL=http://3.6.125.232:3000

# update pcrs
sui client call --function update_pcrs --module enclave --package $ENCLAVE_PACKAGE_ID --type-args "$APP_PACKAGE_ID::$MODULE_NAME::$OTW_NAME" --args $ENCLAVE_CONFIG_OBJECT_ID $CAP_OBJECT_ID 0x$PCR0 0x$PCR1 0x$PCR2

# optional, update name
sui client call --function update_name --module enclave --package $ENCLAVE_PACKAGE_ID --type-args "$APP_PACKAGE_ID::$MODULE_NAME::$OTW_NAME" --args $ENCLAVE_CONFIG_OBJECT_ID $CAP_OBJECT_ID "some name here"

# register the enclave onchain 
sh register_enclave.sh $ENCLAVE_PACKAGE_ID $APP_PACKAGE_ID $ENCLAVE_CONFIG_OBJECT_ID $ENCLAVE_URL $MODULE_NAME $OTW_NAME

# read from output the created enclave obj id and finds its initial shared version 
ENCLAVE_OBJECT_ID=0xfeef53088a8cda3eba6ac993b59b456b229d0cb7239b9b36484e0dd510adc79d
ENCLAVE_OBJ_VERSION=732722330